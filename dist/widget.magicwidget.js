/*!
 * MagicWidget JavaScript Library 1.0.0
 * 
 * Copyright 2017, SupportBee Inc.
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("MagicWidget",[],t):"object"==typeof exports?exports.MagicWidget=t():e.MagicWidget=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([,,,function(e){e.exports='<!DOCTYPE html> <html> <head> <style type=text/css>body,html{height:100%;overflow:hidden}</style> <script>!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Postmate=t()}(this,function(){"use strict";function h(){var e;p.debug&&(e=console).log.apply(e,arguments)}function c(e,t){return e.origin===t&&"object"===n(e.data)&&"postmate"in e.data&&e.data.type===u&&!!{"handshake-reply":1,call:1,emit:1,reply:1,request:1}[e.data.postmate]}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),u="application/x-postmate-v1+json",d=Object.prototype.hasOwnProperty,o=0,m=function(){function t(e){var a=this;r(this,t),this.parent=e.parent,this.frame=e.frame,this.child=e.child,this.childOrigin=e.childOrigin,this.events={},h("Parent: Registering API"),h("Parent: Awaiting messages..."),this.listener=function(e){var t=((e||{}).data||{}).value||{},n=t.data,i=t.name;"emit"===e.data.postmate&&(h("Parent: Received event emission: "+i),i in a.events&&a.events[i].call(a,n))},this.parent.addEventListener("message",this.listener,!1),h("Parent: Awaiting event emissions from Child")}return e(t,[{key:"get",value:function(e){var a=this;return new p.Promise(function(n){var i=++o;a.parent.addEventListener("message",function e(t){t.data.uid===i&&"reply"===t.data.postmate&&(a.parent.removeEventListener("message",e,!1),n(t.data.value))},!1),a.child.postMessage({postmate:"request",type:u,property:e,uid:i},a.childOrigin)})}},{key:"call",value:function(e,t){this.child.postMessage({postmate:"call",type:u,property:e,data:t},this.childOrigin)}},{key:"on",value:function(e,t){this.events[e]=t}},{key:"destroy",value:function(){h("Parent: Destroying Postmate instance"),window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)}}]),t}(),l=function(){function t(e){var d=this;r(this,t),this.model=e.model,this.parent=e.parent,this.parentOrigin=e.parentOrigin,this.child=e.child,h("Child: Registering API"),h("Child: Awaiting messages..."),this.child.addEventListener("message",function(t){if(c(t,d.parentOrigin)){h("Child: Received request",t.data);var e=t.data,n=e.property,i=e.uid,a=e.data;if("call"===t.data.postmate)return void(n in d.model&&"function"==typeof d.model[n]&&d.model[n].call(d,a));(r=d.model,o=n,s="function"==typeof r[o]?r[o]():r[o],p.Promise.resolve(s)).then(function(e){return t.source.postMessage({property:n,postmate:"reply",type:u,uid:i,value:e},t.origin)})}var r,o,s})}return e(t,[{key:"emit",value:function(e,t){h(\'Child: Emitting Event "\'+e+\'"\',t),this.parent.postMessage({postmate:"emit",type:u,value:{name:e,data:t}},this.parentOrigin)}}]),t}(),p=function(){function l(e){r(this,l);var t=e.container,n=e.url,i=e.model;return this.parent=window,this.frame=document.createElement("iframe"),(t||document.body).appendChild(this.frame),this.child=this.frame.contentWindow||this.frame.contentDocument.parentWindow,this.model=i||{},this.sendHandshake(n)}return e(l,[{key:"sendHandshake",value:function(a){var e,t,r=this,o=(e=a,(t=document.createElement("a")).href=e,t.origin||t.protocol+"//"+t.hostname),s=0,d=void 0;return new l.Promise(function(n,i){r.parent.addEventListener("message",function e(t){return!!c(t,o)&&("handshake-reply"===t.data.postmate?(clearInterval(d),h("Parent: Received handshake reply from Child"),r.parent.removeEventListener("message",e,!1),r.childOrigin=t.origin,h("Parent: Saving Child origin",r.childOrigin),n(new m(r))):(h("Parent: Invalid handshake reply"),i("Failed handshake")))},!1);var e=function(){h("Parent: Sending handshake attempt "+ ++s,{childOrigin:o}),r.child.postMessage({postmate:"handshake",type:u,model:r.model},o),5===s&&clearInterval(d)},t=function(){e(),d=setInterval(e,500)};r.frame.attachEvent?r.frame.attachEvent("onload",t):r.frame.onload=t,h("Parent: Loading frame",{url:a}),r.frame.src=a})}}]),l}();return p.debug=!1,p.Promise=function(){try{return window?window.Promise:Promise}catch(e){return null}}(),p.Model=function(){function t(e){return r(this,t),this.child=window,this.model=e,this.parent=this.child.parent,this.sendHandshakeReply()}return e(t,[{key:"sendHandshakeReply",value:function(){var s=this;return new p.Promise(function(r,o){s.child.addEventListener("message",function e(t){if("handshake"===t.data.postmate){h("Child: Received handshake from Parent"),s.child.removeEventListener("message",e,!1),h("Child: Sending handshake reply to Parent"),t.source.postMessage({postmate:"handshake-reply",type:u},t.origin),s.parentOrigin=t.origin;var n=t.data.model;if(n){for(var i=Object.keys(n),a=0;a<i.length;a++)d.call(n,i[a])&&(s.model[i[a]]=n[i[a]]);h("Child: Inherited and extended model from Parent")}return h("Child: Saving Parent origin",s.parentOrigin),r(new l(s))}return o("Handshake Reply Failed")},!1)})}}]),t}(),p})<\/script> </head> <body> </body> </html>'},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="application/x-postmate-v1+json",i=Object.prototype.hasOwnProperty,r=0,a=function(){return++r},o=function(e){var t=document.createElement("a");return t.href=e,t.origin||t.protocol+"//"+t.hostname},s=function(e,t){return e.origin===t&&"object"==typeof e.data&&"postmate"in e.data&&e.data.type===n&&!!{"handshake-reply":1,call:1,emit:1,reply:1,request:1}[e.data.postmate]},d=function(e,t){var n="function"==typeof e[t]?e[t]():e[t];return c.Promise.resolve(n)},l=function(){function e(e){var t=this;this.parent=e.parent,this.frame=e.frame,this.child=e.child,this.childOrigin=e.childOrigin,this.events={},this.listener=function(e){var n=((e||{}).data||{}).value||{},i=n.data,r=n.name;"emit"===e.data.postmate&&r in t.events&&t.events[r].call(t,i)},this.parent.addEventListener("message",this.listener,!1)}var t=e.prototype;return t.get=function(e){var t=this;return new c.Promise(function(i){var r=a();t.parent.addEventListener("message",function e(n){n.data.uid===r&&"reply"===n.data.postmate&&(t.parent.removeEventListener("message",e,!1),i(n.data.value))},!1),t.child.postMessage({postmate:"request",type:n,property:e,uid:r},t.childOrigin)})},t.call=function(e,t){this.child.postMessage({postmate:"call",type:n,property:e,data:t},this.childOrigin)},t.on=function(e,t){this.events[e]=t},t.destroy=function(){window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)},e}(),h=function(){function e(e){var t=this;this.model=e.model,this.parent=e.parent,this.parentOrigin=e.parentOrigin,this.child=e.child,this.child.addEventListener("message",function(e){if(s(e,t.parentOrigin)){var i=e.data,r=i.property,a=i.uid,o=i.data;if("call"===e.data.postmate)return void(r in t.model&&"function"==typeof t.model[r]&&t.model[r].call(t,o));d(t.model,r).then(function(t){return e.source.postMessage({property:r,postmate:"reply",type:n,uid:a,value:t},e.origin)})}})}return e.prototype.emit=function(e,t){this.parent.postMessage({postmate:"emit",type:n,value:{name:e,data:t}},this.parentOrigin)},e}(),c=function(){function e(e){var t=void 0===e?userOptions:e,n=t.container,i=void 0===n?void 0!==i?i:document.body:n,r=t.model,a=t.url;return this.parent=window,this.frame=document.createElement("iframe"),i.appendChild(this.frame),this.child=this.frame.contentWindow||this.frame.contentDocument.parentWindow,this.model=r||{},this.sendHandshake(a)}return e.prototype.sendHandshake=function(t){var i,r=this,a=o(t),d=0;return new e.Promise(function(e,o){r.parent.addEventListener("message",function t(n){return!!s(n,a)&&("handshake-reply"===n.data.postmate?(clearInterval(i),r.parent.removeEventListener("message",t,!1),r.childOrigin=n.origin,e(new l(r))):o("Failed handshake"))},!1);var h=function(){d++,r.child.postMessage({postmate:"handshake",type:n,model:r.model},a),5===d&&clearInterval(i)},c=function(){h(),i=setInterval(h,500)};r.frame.attachEvent?r.frame.attachEvent("onload",c):r.frame.onload=c,r.frame.src=t})},e}();c.debug=!1,c.Promise=function(){try{return window?window.Promise:Promise}catch(e){return null}}(),c.Model=function(){function e(e){return this.child=window,this.model=e,this.parent=this.child.parent,this.sendHandshakeReply()}return e.prototype.sendHandshakeReply=function(){var e=this;return new c.Promise(function(t,r){e.child.addEventListener("message",function a(o){if(o.data.postmate){if("handshake"===o.data.postmate){e.child.removeEventListener("message",a,!1),o.source.postMessage({postmate:"handshake-reply",type:n},o.origin),e.parentOrigin=o.origin;var s=o.data.model;if(s)for(var d=Object.keys(s),l=0;d.length>l;l++)i.call(s,d[l])&&(e.model[d[l]]=s[d[l]]);return t(new h(e))}return r("Handshake Reply Failed")}},!1)})},e}(),t.default=c},,function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}i((i(n(3)),n(4)))}])});